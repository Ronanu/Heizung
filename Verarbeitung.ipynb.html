<html>
<head>
<title>Verarbeitung.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Verarbeitung.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span><span class="s1">%matplotlib notebook</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">import </span><span class="s1">csv</span>
<span class="s2">import </span><span class="s1">re</span>


<span class="s1">MonthDict = {</span>
    <span class="s3">1</span><span class="s1">: </span><span class="s4">&quot;January&quot;</span><span class="s2">,</span>
    <span class="s3">2</span><span class="s1">: </span><span class="s4">&quot;February&quot;</span><span class="s2">,</span>
    <span class="s3">3</span><span class="s1">: </span><span class="s4">&quot;March&quot;</span><span class="s2">,</span>
    <span class="s3">4</span><span class="s1">: </span><span class="s4">&quot;April&quot;</span><span class="s2">,</span>
    <span class="s3">5</span><span class="s1">: </span><span class="s4">&quot;May&quot;</span><span class="s2">,</span>
    <span class="s3">6</span><span class="s1">: </span><span class="s4">&quot;June&quot;</span><span class="s2">,</span>
    <span class="s3">7</span><span class="s1">: </span><span class="s4">&quot;July&quot;</span><span class="s2">,</span>
    <span class="s3">8</span><span class="s1">: </span><span class="s4">&quot;August&quot;</span><span class="s2">,</span>
    <span class="s3">9</span><span class="s1">: </span><span class="s4">&quot;September&quot;</span><span class="s2">,</span>
    <span class="s3">10</span><span class="s1">: </span><span class="s4">&quot;October&quot;</span><span class="s2">,</span>
    <span class="s3">11</span><span class="s1">: </span><span class="s4">&quot;November&quot;</span><span class="s2">,</span>
    <span class="s3">12</span><span class="s1">: </span><span class="s4">&quot;December&quot;</span>
<span class="s1">}</span>
<span class="s0">#%% md 
</span><span class="s1">## Die Input Klasse 
Diese Klasse hat die Aufgabe, die Heizungsmessdaten aus der csv zu lesen. 
</span><span class="s0">#%% 
</span><span class="s2">class </span><span class="s1">InPackage:</span>
    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">, </span><span class="s1">splitter=</span><span class="s4">'-|:|,|T'</span><span class="s1">):</span>
        <span class="s1">self.filename = filename</span>
        <span class="s1">self.splitter = splitter</span>

    <span class="s2">def </span><span class="s1">read_and_split(self):</span>
        <span class="s2">with </span><span class="s1">open(</span><span class="s4">'feeds.csv'</span><span class="s2">, </span><span class="s1">newline=</span><span class="s4">''</span><span class="s1">) </span><span class="s2">as </span><span class="s1">csvfile:</span>
            <span class="s1">spamreader = csv.reader(csvfile</span><span class="s2">, </span><span class="s1">delimiter=</span><span class="s4">' '</span><span class="s2">, </span><span class="s1">quotechar=</span><span class="s4">'|'</span><span class="s1">)</span>
            <span class="s1">data = {}</span>
            <span class="s2">for </span><span class="s1">_row </span><span class="s2">in </span><span class="s1">spamreader:</span>
                <span class="s2">try</span><span class="s1">:</span>
                    <span class="s1">row = re.split(self.splitter</span><span class="s2">, </span><span class="s1">_row[</span><span class="s3">0</span><span class="s1">])</span>
                    <span class="s1">year = row[</span><span class="s3">0</span><span class="s1">]</span>
                    <span class="s1">month = int(row[</span><span class="s3">1</span><span class="s1">])</span>
                    <span class="s1">date = int(row[</span><span class="s3">2</span><span class="s1">])</span>
                    <span class="s1">time = </span><span class="s4">':'</span><span class="s1">.join(row[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">6</span><span class="s1">])[:-</span><span class="s3">3</span><span class="s1">]</span>
                    <span class="s1">counter = row[</span><span class="s3">7</span><span class="s1">]</span>
                    <span class="s1">time_on = float(row[</span><span class="s3">8</span><span class="s1">])</span>
                    <span class="s0"># entries.append(Entry(year, month, date, time, counter, time_on))</span>
                    <span class="s2">if </span><span class="s1">year </span><span class="s2">not in </span><span class="s1">data.keys():</span>
                        <span class="s1">data[year] = dict()</span>
                        <span class="s1">data[year][</span><span class="s4">'t'</span><span class="s1">] = </span><span class="s3">0.</span>
                    <span class="s2">if </span><span class="s1">month </span><span class="s2">not in </span><span class="s1">data[year].keys():</span>
                        <span class="s1">data[year][month] = {</span><span class="s4">'t'</span><span class="s1">: </span><span class="s3">0.</span><span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">date </span><span class="s2">not in </span><span class="s1">data[year][month].keys():</span>
                        <span class="s1">data[year][month][date] = {</span><span class="s4">'t'</span><span class="s1">: </span><span class="s3">0.</span><span class="s1">}</span>
                    <span class="s1">data[year][month][date][time] = time_on</span>
                    <span class="s1">data[year][</span><span class="s4">'t'</span><span class="s1">] += time_on</span>
                    <span class="s1">data[year][month][</span><span class="s4">'t'</span><span class="s1">] += time_on</span>
                    <span class="s1">data[year][month][date][</span><span class="s4">'t'</span><span class="s1">] += time_on</span>
                <span class="s2">except</span><span class="s1">:</span>
                    <span class="s2">pass</span>
        <span class="s2">return </span><span class="s1">data</span>
<span class="s0">#%% md 
</span><span class="s1">## Klasse Öltank 
</span><span class="s0">#%% 
</span><span class="s2">import </span><span class="s1">sympy </span><span class="s2">as </span><span class="s1">sp</span>
<span class="s2">import </span><span class="s1">sympy.abc </span><span class="s2">as </span><span class="s1">abc</span>

<span class="s2">class </span><span class="s1">Oeltank:</span>
    <span class="s0"># Dimensionen:</span>
    <span class="s1">lx = </span><span class="s3">3    </span><span class="s0"># m</span>
    <span class="s1">ly = </span><span class="s3">1.5  </span><span class="s0"># m</span>
    <span class="s1">lz = </span><span class="s3">0.</span>

    <span class="s2">def </span><span class="s1">set_dh(self</span><span class="s2">, </span><span class="s1">h):</span>
        <span class="s1">self.lz = h</span>

    <span class="s2">def </span><span class="s1">calc_v(self):</span>
        <span class="s2">return </span><span class="s1">self.lx * self.ly * self.lz</span>

    <span class="s2">def </span><span class="s1">get_v(self):</span>
        <span class="s2">return </span><span class="s1">self.calc_v()</span>

<span class="s1">oel = Oeltank()</span>
<span class="s1">oel.set_dh(</span><span class="s3">1.5</span><span class="s1">)</span>
<span class="s1">print(oel.get_v())</span>
<span class="s0">#%% md 
</span><span class="s1"># Beginn der Verarbeitung 
## Einlesen der Messdaten 
Seit 2018 werden die Einschaltzeiten der Heizung und der jeweilige Ölverbrauch aufgezeichnet. Das objekt datareader liest mit der Methode *read_and split* die Messpunkte aus einer .csv . 
</span><span class="s0">#%% 
</span><span class="s1">datareader = InPackage(filename=</span><span class="s4">'feeds.csv'</span><span class="s1">)</span>
<span class="s1">data = datareader.read_and_split()</span>
<span class="s1">data</span>
<span class="s0">#%% md 
</span><span class="s1">## Jahresmenge 
</span><span class="s0">#%% 
</span><span class="s1">fig = plt.figure()</span>
<span class="s1">years = sorted(data.keys())</span>
<span class="s1">plt.bar(years</span><span class="s2">, </span><span class="s1">[data[year][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span><span class="s1">/</span><span class="s3">24 </span><span class="s2">for </span><span class="s1">year </span><span class="s2">in </span><span class="s1">years])</span>
<span class="s1">plt.title(</span><span class="s4">'Gemessene Heizzeit in Tage'</span><span class="s1">)</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Jahr'</span><span class="s1">)</span>
<span class="s1">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s1"># Leistung anhand der Maschinendaten 
Hier wird die gemessene Zeit direkt mit der Brennerleistung multipliziert, um zur verbrauchten Energie zu kommen. Später wird die Messzeit statistisch abgeglichen. Dabei werden Ausfalltage einzelner jahre mit äuivalenten Messdaten anderer Jahre ersetzt. 
Die so erhaltene wahre Zeit kann zu einer reevaluierung der Brennerleistung verwendet werden. 
</span><span class="s0">#%% 
# Vergleich mit Kenndaten</span>
<span class="s1">Wirkungsgrad = </span><span class="s3">0.852</span>
<span class="s1">leistung = </span><span class="s3">70000  </span><span class="s0"># WE</span>
<span class="s1">leistung = leistung / </span><span class="s3">860  </span><span class="s0"># umrechnung in kW</span>

<span class="s1">print(</span><span class="s4">&quot;Leistung aus Kenndaten: &quot; </span><span class="s1">+ str(round(leistung</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)) + </span><span class="s4">&quot;kW&quot;</span><span class="s1">)</span>
<span class="s0">##################################################################################</span>
<span class="s0"># Vergleich mit Ölstand</span>

<span class="s1">Vol_Öl = </span><span class="s3">15 </span><span class="s1">* </span><span class="s3">30 </span><span class="s1">* (</span><span class="s3">13.7 </span><span class="s1">- </span><span class="s3">6.85</span><span class="s1">)  </span><span class="s0"># in l</span>
<span class="s1">Heitzwert = </span><span class="s3">10.9  </span><span class="s0"># kWh/l</span>
<span class="s1">Energie_Öl = Vol_Öl * Heitzwert  </span><span class="s0"># kWh</span>
<span class="s1">Energie_nutz = Energie_Öl * Wirkungsgrad </span><span class="s0"># kWh/l</span>
<span class="s0">#%% md 
</span><span class="s1">## Monatsmenge 
</span><span class="s0">#%% 
</span><span class="s1">year_month_matrix = sp.zeros(len(years)</span><span class="s2">, </span><span class="s3">12</span><span class="s1">)</span>
<span class="s1">fig = plt.figure()</span>
<span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">year </span><span class="s2">in </span><span class="s1">enumerate(years):</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">month </span><span class="s2">in </span><span class="s1">enumerate(data[year].keys()):</span>
        <span class="s2">if </span><span class="s1">month == </span><span class="s4">'t'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s1">m_time = data[year][month][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span>
        <span class="s1">year_month_matrix[i-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">j-</span><span class="s3">1</span><span class="s1">] = m_time</span>
        <span class="s1">plt.bar(month</span><span class="s2">, </span><span class="s1">m_time</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span>
<span class="s1">plt.title(</span><span class="s4">'gemessene Heizdauer in Stunden'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Monat'</span><span class="s1">)</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.show()</span>
<span class="s0">#%% 
</span><span class="s1">fig = plt.figure()</span>
<span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">year </span><span class="s2">in </span><span class="s1">enumerate(years):</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">month </span><span class="s2">in </span><span class="s1">enumerate(data[year].keys()):</span>
        <span class="s2">if </span><span class="s1">month == </span><span class="s4">'t'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s1">m_time = leistung * data[year][month][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span>
        <span class="s1">plt.bar(month</span><span class="s2">, </span><span class="s1">m_time</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span>
<span class="s1">plt.title(</span><span class="s4">'Energiemenge in kWh'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Monat'</span><span class="s1">)</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s1">## Tagesmenge 
</span><span class="s0">#%% 
</span><span class="s1">fig = plt.figure()</span>
<span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">year </span><span class="s2">in </span><span class="s1">enumerate(years):</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">month </span><span class="s2">in </span><span class="s1">enumerate(data[year].keys()):</span>
        <span class="s2">if </span><span class="s1">month == </span><span class="s4">'t'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s2">for </span><span class="s1">day </span><span class="s2">in </span><span class="s1">data[year][month].keys():</span>
            <span class="s2">if </span><span class="s1">day == </span><span class="s4">'t'</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">m_time = data[year][month][day][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span>
            <span class="s1">plt.scatter(x=month*</span><span class="s3">31</span><span class="s1">+day</span><span class="s2">, </span><span class="s1">y=m_time</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span>
<span class="s1">plt.title(</span><span class="s4">'Heizzeit in h'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Tage'</span><span class="s1">)</span>
<span class="s1">plt.xlim((</span><span class="s3">1</span><span class="s2">, </span><span class="s3">365</span><span class="s1">))</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.show()</span>
<span class="s0">#%% 
</span><span class="s1">fig = plt.figure()</span>
<span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">year </span><span class="s2">in </span><span class="s1">enumerate(years):</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">month </span><span class="s2">in </span><span class="s1">enumerate(data[year].keys()):</span>
        <span class="s2">if </span><span class="s1">month == </span><span class="s4">'t'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s2">for </span><span class="s1">day </span><span class="s2">in </span><span class="s1">data[year][month].keys():</span>
            <span class="s2">if </span><span class="s1">day == </span><span class="s4">'t'</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">m_time = leistung * data[year][month][day][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span>
            <span class="s1">plt.scatter(x=month*</span><span class="s3">31</span><span class="s1">+day</span><span class="s2">, </span><span class="s1">y=m_time</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s3">0.9</span><span class="s1">)</span>

<span class="s1">plt.title(</span><span class="s4">'Energiemenge in kWh'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Tage'</span><span class="s1">)</span>
<span class="s1">plt.xlim((</span><span class="s3">1</span><span class="s2">, </span><span class="s3">365</span><span class="s1">))</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.show()</span>
<span class="s0">#%% 
</span><span class="s1">fig = plt.figure()</span>
<span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">year </span><span class="s2">in </span><span class="s1">enumerate(years):</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">month </span><span class="s2">in </span><span class="s1">enumerate(data[year].keys()):</span>
        <span class="s2">if </span><span class="s1">month == </span><span class="s4">'t'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s2">for </span><span class="s1">day </span><span class="s2">in </span><span class="s1">data[year][month].keys():</span>
            <span class="s2">if </span><span class="s1">day == </span><span class="s4">'t'</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">m_time = leistung * data[year][month][day][</span><span class="s4">'t'</span><span class="s1">]/</span><span class="s3">3600</span>
            <span class="s1">plt.scatter(x=</span><span class="s3">365</span><span class="s1">*i+month*</span><span class="s3">31</span><span class="s1">+day</span><span class="s2">, </span><span class="s1">y=m_time</span><span class="s2">, </span><span class="s1">marker=</span><span class="s4">'.'</span><span class="s1">)</span>

<span class="s1">plt.title(</span><span class="s4">'Energiemenge in kWh'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Tage'</span><span class="s1">)</span>
<span class="s1">plt.grid()</span>
<span class="s1">plt.show()</span></pre>
</body>
</html>